"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.mapFacetArrayCached = void 0;
const types_1 = require("../types");
const mapIntoObserveArray_1 = require("./mapIntoObserveArray");
const facet_1 = require("../facet");
function mapFacetArrayCached(facets, fn, equalityCheck) {
    const cachedFacet = (0, facet_1.createFacet)({
        // pass the equalityCheck to the mapIntoObserveArray to prevent even triggering the observable
        startSubscription: (0, mapIntoObserveArray_1.mapIntoObserveArray)(facets, fn, equalityCheck),
        initialValue: types_1.NO_VALUE,
    });
    return {
        get: () => {
            const cachedValue = cachedFacet.get();
            if (cachedValue !== types_1.NO_VALUE)
                return cachedValue;
            const dependencyValues = facets.map((facet) => facet.get());
            const hasAllValues = dependencyValues.reduce((acc, value) => acc && value !== types_1.NO_VALUE, true);
            if (!hasAllValues)
                return types_1.NO_VALUE;
            const mappedValue = fn(...dependencyValues);
            if (mappedValue !== types_1.NO_VALUE)
                cachedFacet.set(mappedValue);
            return mappedValue;
        },
        observe: cachedFacet.observe,
    };
}
exports.mapFacetArrayCached = mapFacetArrayCached;
//# sourceMappingURL=mapFacetArrayCached.js.map