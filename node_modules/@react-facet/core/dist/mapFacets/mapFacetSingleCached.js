"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.mapFacetSingleCached = void 0;
const types_1 = require("../types");
const mapIntoObserveSingle_1 = require("./mapIntoObserveSingle");
const facet_1 = require("../facet");
function mapFacetSingleCached(facet, fn, equalityCheck) {
    const cachedFacet = (0, facet_1.createFacet)({
        // pass the equalityCheck to the mapIntoObserveSingle to prevent even triggering the observable
        startSubscription: (0, mapIntoObserveSingle_1.mapIntoObserveSingle)(facet, fn, equalityCheck),
        initialValue: types_1.NO_VALUE,
    });
    return {
        get: () => {
            const cachedValue = cachedFacet.get();
            if (cachedValue !== types_1.NO_VALUE)
                return cachedValue;
            const dependencyValue = facet.get();
            if (dependencyValue === types_1.NO_VALUE)
                return types_1.NO_VALUE;
            const mappedValue = fn(dependencyValue);
            if (mappedValue !== types_1.NO_VALUE)
                cachedFacet.set(mappedValue);
            return mappedValue;
        },
        observe: cachedFacet.observe,
    };
}
exports.mapFacetSingleCached = mapFacetSingleCached;
//# sourceMappingURL=mapFacetSingleCached.js.map